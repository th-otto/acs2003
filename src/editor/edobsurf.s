		.text

char_x:
		tst.w      d0
		bpl.s      char_x_1
		move.w     d0,d1
		lsl.w      #8,d1
		move.w     d1,d0
		rts
char_x_1:

		lea.l      ACSblk,a0
		move.w     snapping,d1
		beq.s      x2d894_1
		movea.l    (a0),a1
		move.w     18(a1),d2
		asr.w      #1,d2
		add.w      d0,d2
		ext.l      d2
		divs.w     18(a1),d2
		move.w     d2,d0
		rts
x2d894_1:

		move.w     d0,d1
		ext.l      d1
		movea.l    (a0),a1
		divs.w     18(a1),d1
		move.w     d0,d2
		ext.l      d2
		divs.w     18(a1),d2
		swap       d2
		lsl.w      #8,d2
		or.w       d2,d1
		move.w     d1,d0
		rts

char_y:
		tst.w      d0
		bpl.s      char_y_1
		move.w     d0,d1
		lsl.w      #8,d1
		move.w     d1,d0
		rts
char_y_1:

		lea.l      ACSblk,a0
		move.w     snapping,d1
		beq.s      x2d8de_1
		movea.l    (a0),a1
		move.w     20(a1),d2
		asr.w      #1,d2
		add.w      d0,d2
		ext.l      d2
		divs.w     20(a1),d2
		move.w     d2,d0
		rts
x2d8de_1:

		move.w     d0,d1
		ext.l      d1
		movea.l    (a0),a1
		divs.w     20(a1),d1
		move.w     d0,d2
		ext.l      d2
		divs.w     20(a1),d2
		swap       d2
		lsl.w      #8,d2
		or.w       d2,d1
		move.w     d1,d0
		rts

pixel_x:
		move.w     d0,d1
		asr.w      #8,d1
		and.w      #$00FF,d1
		cmp.w      #$007F,d1
		ble.s      pixel_x_1
		sub.w      #$0100,d1
pixel_x_1:
		move.w     d0,d2
		and.w      #$00FF,d2
		movea.l    ACSblk,a0
		muls.w     18(a0),d2
		add.w      d1,d2
		move.w     d2,d0
		rts

pixel_y:
		move.w     d0,d1
		asr.w      #8,d1
		and.w      #$00FF,d1
		cmp.w      #$007F,d1
		ble.s      pixel_y_1
		sub.w      #$0100,d1
pixel_y_1:
		move.w     d0,d2
		and.w      #$00FF,d2
		movea.l    ACSblk,a0
		muls.w     20(a0),d2
		add.w      d1,d2
		move.w     d2,d0
		rts

del_obentry:
		movem.l    d3-d6/a2-a5,-(a7)
		subq.w     #4,a7
		move.l     a0,(a7)
		move.w     d0,d3
		move.w     d1,d6
		movea.l    20(a0),a3
		movea.l    (a0),a0
		movea.l    (a0),a4
		movea.l    4(a0),a5
		moveq.l    #-2,d4
		add.w      d0,d4
		ext.l      d4
		divs.w     #$0003,d4
		movea.l    4(a5),a2
		cmp.w      24(a0),d0
		bne.s      del_obentry_1
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d2
		lsl.l      #3,d2
		sub.l      d1,d2
		lsl.l      #3,d2
		move.w     10(a2,d2.l),d5
		tst.w      d5
		bmi        del_obentry_2
		cmp.w      12(a2,d2.l),d5
		bne        del_obentry_2
		move.w     d5,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     24(a2,d2.l),24(a2,d0.l)
		move.w     26(a2,d2.l),26(a2,d0.l)
		lea.l      0(a2,d2.l),a1
		movea.l    a4,a0
		jsr        del_ob
		move.w     d4,d0
		movea.l    a2,a0
		jsr        unlink_ob
		bra.s      del_obentry_2
del_obentry_1:
		tst.w      d6
		beq.s      del_obentry_3
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		lea.l      0(a2,d0.l),a1
		movea.l    a4,a0
		jsr        del_ob
		move.w     d4,d0
		movea.l    a2,a0
		jsr        unlink_ob
		bra.s      del_obentry_4
del_obentry_3:
		move.w     d4,d0
		movea.l    a5,a1
		movea.l    a4,a0
		jsr        delsub_ob
		moveq.l    #-1,d0
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,4(a3,d1.l)
		move.w     d0,2(a3,d1.l)
del_obentry_4:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		ori.w      #$0080,-16(a3,d0.l)
		moveq.l    #-1,d0
		add.w      d3,d0
		movea.l    (a7),a0
		jsr        Awi_obredraw
del_obentry_2:
		addq.w     #4,a7
		movem.l    (a7)+,d3-d6/a2-a5
		rts

ed_delete:
		movem.l    d3-d4/a2-a4,-(a7)
		subq.w     #4,a7
		movea.l    a0,a2
		movea.l    (a0),a3
		cmpi.w     #$0001,8(a3)
		bne        ed_delete_1
		movea.l    ACSblk,a1
		cmpa.l     576(a1),a0
		bne        ed_delete_1
		move.l     _globl,-(a7)
		pea.l      6(a7)
		pea.l      8(a7)
		lea.l      12(a7),a1
		lea.l      12(a7),a0
		jsr        mt_graf_mkstate
		lea.l      12(a7),a7
		andi.w     #$0004,2(a7)
		clr.w      d3
		jsr        Adr_start
		bra.s      ed_delete_2
ed_delete_6:
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		movea.l    20(a2),a4
		lea.l      24(a4,d0.l),a4
		cmpi.w     #$2AF8,22(a4)
		bne.s      ed_delete_2
		movea.l    a2,a0
		move.w     d4,d0
		jsr        Adr_del
		cmp.w      24(a3),d4
		bne.s      ed_delete_3
		moveq.l    #1,d3
ed_delete_3:
		move.w     2(a7),d0
		beq.s      ed_delete_4
		moveq.l    #1,d1
		bra.s      ed_delete_5
ed_delete_4:
		clr.w      d1
ed_delete_5:
		move.w     d4,d0
		movea.l    a2,a0
		bsr        del_obentry
ed_delete_2:
		jsr        Adr_next
		move.w     d0,d4
		bpl.s      ed_delete_6
		movea.l    4(a3),a0
		jsr        pack_ob
		movea.l    a2,a0
		movea.l    16(a2),a1
		jsr        (a1)
		tst.w      d3
		beq.s      ed_delete_7
		ori.w      #$0010,86(a2)
		lea.l      36(a2),a1
		movea.l    a2,a0
		movea.l    134(a2),a4
		jsr        (a4)
ed_delete_7:
		move.w     #$FFFF,10(a3)
ed_delete_1:
		addq.w     #4,a7
		movem.l    (a7)+,d3-d4/a2-a4
		rts

ed_dragged:
		movem.l    d3-d4/a2-a5,-(a7)
		lea.l      -12(a7),a7
		movea.l    ACSblk,a0
		move.w     592(a0),d0
		bne.s      ed_dragged_1
		move.w     594(a0),d1
		beq        ed_dragged_2
ed_dragged_1:
		movea.l    ACSblk,a0
		movea.l    576(a0),a3
		movea.l    600(a0),a4
		lea.l      10(a7),a2
		move.l     _globl,-(a7)
		movea.l    ACSblk,a0
		pea.l      614(a0)
		pea.l      (a2)
		movea.l    a2,a1
		movea.l    a2,a0
		jsr        mt_graf_mkstate
		lea.l      12(a7),a7
		moveq.l    #1,d0
		movea.l    ACSblk,a0
		and.w      614(a0),d0
		beq.s      ed_dragged_3
		ori.w      #$0002,614(a0)
ed_dragged_3:
		cmpa.l     a3,a4
		beq.s      ed_dragged_4
		movea.l    ACSblk,a0
		ori.w      #$0004,614(a0)
ed_dragged_4:
		moveq.l    #6,d0
		movea.l    ACSblk,a0
		and.w      614(a0),d0
		move.w     d0,(a2)
		cmpa.l     a3,a4
		bne.s      ed_dragged_5
		subq.w     #2,d0
		beq.s      ed_dragged_5
		cmpi.w     #$0006,(a2)
		beq.s      ed_dragged_5
		moveq.l    #1,d4
		bra.s      ed_dragged_6
ed_dragged_5:
		clr.w      d4
ed_dragged_6:
		tst.w      d4
		beq.s      ed_dragged_7
		movea.l    (a4),a2
		movea.l    ACSblk,a0
		clr.w      584(a0)
		bra.s      ed_dragged_8
ed_dragged_10:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		movea.l    20(a3),a5
		lea.l      24(a5,d0.l),a5
		cmpi.w     #$2AF8,22(a5)
		bne.s      ed_dragged_8
		cmp.w      24(a2),d3
		beq.s      ed_dragged_9
		movea.l    20(a4),a0
		ori.w      #$0080,-16(a0,d0.l)
		movea.l    20(a4),a0
		ori.w      #$0080,8(a0,d0.l)
		movea.l    20(a4),a0
		andi.w     #$FFFE,10(a0,d0.l)
		moveq.l    #-1,d0
		add.w      d3,d0
		movea.l    a4,a0
		jsr        Awi_obredraw
		bra.s      ed_dragged_8
ed_dragged_9:
		move.w     d3,d0
		movea.l    a3,a0
		jsr        Adr_del
ed_dragged_8:
		jsr        Adr_next
		move.w     d0,d3
		bpl.s      ed_dragged_10
ed_dragged_7:
		clr.w      (a7)
		movea.l    ACSblk,a0
		clr.w      584(a0)
		bra.s      ed_dragged_11
ed_dragged_12:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		movea.l    20(a3),a5
		lea.l      24(a5,d0.l),a5
		cmpi.w     #$2AF8,22(a5)
		bne.s      ed_dragged_11
		lea.l      (a7),a1
		movea.l    a4,a0
		move.w     d3,d0
		move.w     d4,d1
		jsr        new_ob
ed_dragged_11:
		jsr        Adr_next
		move.w     d0,d3
		bpl.s      ed_dragged_12
		move.w     (a7),d1
		ble.s      ed_dragged_2
		movea.l    a4,a0
		movea.l    16(a4),a1
		jsr        (a1)
		cmpi.w     #$0005,(a7)
		blt.s      ed_dragged_13
		clr.w      d0
		movea.l    a4,a0
		jsr        Awi_obredraw
		bra.s      ed_dragged_2
ed_dragged_13:
		move.w     (a7),d4
		bra.s      ed_dragged_14
ed_dragged_15:
		move.w     d4,d0
		add.w      d0,d0
		move.w     0(a7,d0.w),d3
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d2
		add.l      d2,d2
		add.l      d1,d2
		lsl.l      #3,d2
		movea.l    20(a4),a0
		move.w     10(a0,d2.l),d1
		movea.l    102(a4),a1
		movea.l    a4,a0
		move.w     d3,d0
		jsr        (a1)
		addq.w     #1,d3
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d0
		add.l      d0,d0
		add.l      d2,d0
		lsl.l      #3,d0
		movea.l    20(a4),a0
		move.w     10(a0,d0.l),d1
		movea.l    102(a4),a1
		movea.l    a4,a0
		move.w     d3,d0
		jsr        (a1)
		subq.w     #1,d4
ed_dragged_14:
		tst.w      d4
		bgt.s      ed_dragged_15
ed_dragged_2:
		lea.l      12(a7),a7
		movem.l    (a7)+,d3-d4/a2-a5
		rts

ob_find:
		movem.l    d3-d4/a2-a4,-(a7)
		subq.w     #8,a7
		movea.l    a0,a2
		move.w     d0,d3
		movea.l    a1,a4
		ext.l      d0
		move.l     d0,d1
		add.l      d1,d1
		add.l      d0,d1
		lsl.l      #3,d1
		movea.l    20(a2),a3
		adda.l     d1,a3
		move.w     18(a3),d2
		move.w     2(a4),d1
		add.w      6(a4),d1
		cmp.w      d1,d2
		bge        ob_find_1
		add.w      22(a3),d2
		cmp.w      2(a4),d2
		ble        ob_find_1
		move.w     16(a3),d0
		move.w     (a1),d1
		add.w      4(a4),d1
		cmp.w      d1,d0
		bge        ob_find_1
		add.w      20(a3),d0
		cmp.w      (a1),d0
		ble        ob_find_1
		move.w     18(a3),d2
		cmp.w      2(a4),d2
		blt.s      ob_find_2
		move.w     16(a3),d1
		cmp.w      (a1),d1
		blt.s      ob_find_2
		add.w      22(a3),d2
		move.w     2(a4),d0
		add.w      6(a4),d0
		cmp.w      d0,d2
		bgt.s      ob_find_2
		add.w      20(a3),d1
		move.w     (a1),d2
		add.w      4(a4),d2
		cmp.w      d2,d1
		bgt.s      ob_find_2
		move.w     d3,d0
		jsr        ob_addselect
		bra.s      ob_find_1
ob_find_2:
		move.w     2(a3),d4
		tst.w      d4
		bmi.s      ob_find_1
		move.w     (a4),d0
		sub.w      16(a3),d0
		move.w     d0,(a7)
		move.w     2(a4),d1
		sub.w      18(a3),d1
		move.w     d1,2(a7)
		move.w     4(a4),4(a7)
		move.w     6(a4),6(a7)
		bra.s      ob_find_3
ob_find_4:
		lea.l      (a7),a1
		addq.w     #1,d4
		move.w     d4,d0
		movea.l    a2,a0
		bsr        ob_find
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		movea.l    20(a2),a0
		move.w     0(a0,d0.l),d4
ob_find_3:
		cmp.w      d4,d3
		bne.s      ob_find_4
ob_find_1:
		addq.w     #8,a7
		movem.l    (a7)+,d3-d4/a2-a4
		rts

draw_box:
		movem.l    d3/a2-a5,-(a7)
		subq.w     #8,a7
		movea.l    a0,a2
		movea.l    20(a2),a3
		lea.l      ACSblk,a4
		moveq.l    #3,d0
		movea.l    (a4),a0
		and.w      614(a0),d0
		bne.s      draw_box_1
		jsr        Adr_unselect
draw_box_1:
		movea.l    (a4),a0
		movea.l    572(a0),a0
		lea.l      68(a0),a0
		jsr        Amo_new
		movea.l    (a4),a0
		move.w     610(a0),(a7)
		move.w     612(a0),2(a7)
		moveq.l    #3,d0
		jsr        Awi_update
		move.l     _globl,-(a7)
		move.w     #$F060,-(a7)
		lea.l      12(a7),a1
		lea.l      10(a7),a0
		move.w     #$F060,d2
		movea.l    (a4),a5
		move.w     612(a5),d1
		move.w     610(a5),d0
		jsr        mt_graf_rubbox
		addq.w     #6,a7
		move.w     4(a7),d0
		bpl.s      draw_box_2
		add.w      d0,(a7)
		move.w     4(a7),d0
		neg.w      d0
		move.w     d0,4(a7)
draw_box_2:
		move.w     6(a7),d0
		bpl.s      draw_box_3
		add.w      d0,2(a7)
		move.w     6(a7),d0
		neg.w      d0
		move.w     d0,6(a7)
draw_box_3:
		moveq.l    #2,d0
		jsr        Awi_update
		moveq.l    #2,d3
		movea.l    (a4),a0
		move.l     a2,576(a0)
		move.w     52(a2),d0
		add.w      16(a3),d0
		add.w      d3,d0
		sub.w      d0,(a7)
		move.w     54(a2),d1
		add.w      18(a3),d1
		add.w      d3,d1
		sub.w      d1,2(a7)
		addq.w     #4,4(a7)
		addq.w     #4,6(a7)
		lea.l      (a7),a1
		movea.l    a2,a0
		move.w     d3,d0
		bsr        ob_find
		movea.l    (a4),a0
		movea.l    572(a0),a0
		lea.l      56(a0),a0
		jsr        Amo_new
		addq.w     #8,a7
		movem.l    (a7)+,d3/a2-a5
		rts

ed_edit:
		movem.l    d3-d7/a2-a5,-(a7)
		subq.w     #4,a7
		lea.l      ACSblk,a5
		movea.l    (a5),a0
		movea.l    600(a0),a2
		movea.l    20(a2),a4
		move.w     610(a0),d3
		move.w     612(a0),d4
		move.w     614(a0),d5
		movea.l    (a2),a3
		move.w     608(a0),d6
		move.w     d6,d7
ed_edit_3:
		move.w     d7,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a4,d0.l),d2
		and.w      #$1000,d2
		beq.s      ed_edit_1
		move.w     d7,d6
ed_edit_1:
		cmp.w      24(a3),d7
		beq.s      ed_edit_2
		move.w     d7,d0
		movea.l    a4,a0
		jsr        Aob_up
		move.w     d0,d7
		tst.w      d0
		bpl.s      ed_edit_3
ed_edit_2:
		moveq.l    #4,d0
		and.w      d5,d0
		beq.s      ed_edit_4
		cmp.w      24(a3),d6
		beq.s      ed_edit_4
		movea.l    a4,a0
		move.w     d6,d0
		jsr        Aob_up
		move.w     d0,d6
ed_edit_4:
		movea.l    (a5),a0
		move.w     608(a0),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a4,d0.l),d2
		and.w      #$4000,d2
		beq.s      ed_edit_5
		move.w     d6,608(a0)
		jsr        open_it
		bra        ed_edit_6
ed_edit_5:
		moveq.l    #8,d0
		and.w      d5,d0
		beq.s      ed_edit_7
		movea.l    a2,a0
		bsr        draw_box
		bra        ed_edit_6
ed_edit_7:
		moveq.l    #1,d0
		move.w     d6,d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		and.w      10(a4,d1.l),d0
		beq.s      ed_edit_8
		moveq.l    #3,d7
		and.w      d5,d7
		beq.s      ed_edit_9
		movea.l    a2,a0
		move.w     d6,d0
		jsr        Adr_del
		jsr        Aev_release
		bra.s      ed_edit_6
ed_edit_8:
		moveq.l    #3,d0
		and.w      d5,d0
		bne.s      ed_edit_10
		jsr        Adr_unselect
ed_edit_10:
		move.w     d6,d0
		movea.l    a2,a0
		jsr        ob_addselect
		moveq.l    #2,d7
ed_edit_12:
		lea.l      2(a7),a5
		lea.l      _globl,a3
		subq.w     #1,d7
		movea.l    (a3),a0
		moveq.l    #10,d0
		jsr        mt_evnt_timer
		move.l     (a3),-(a7)
		pea.l      4(a7)
		pea.l      (a5)
		lea.l      12(a7),a1
		lea.l      12(a7),a0
		jsr        mt_graf_mkstate
		lea.l      12(a7),a7
		moveq.l    #1,d0
		and.w      (a5),d0
		subq.w     #1,d0
		bne.s      ed_edit_11
		tst.w      d7
		bgt.s      ed_edit_12
ed_edit_11:
		tst.w      d7
		bgt.s      ed_edit_6
ed_edit_9:
		move.w     d4,d2
		move.w     d3,d1
		move.w     d6,d0
		movea.l    a2,a0
		jsr        sizing
		tst.w      d0
		beq.s      ed_edit_6
		move.w     d4,d1
		move.w     d3,d0
		jsr        Adr_drag
ed_edit_6:
		addq.w     #4,a7
		movem.l    (a7)+,d3-d7/a2-a5
		rts

find_parent:
		movem.l    a2-a6,-(a7)
		lea.l      -12(a7),a7
		movea.l    a0,a2
		movea.l    a1,a6
		movea.l    36(a7),a4
		movea.l    40(a7),a5
		move.l     (a0),8(a7)
		movea.l    ACSblk,a1
		movea.l    576(a1),a3
		move.l     _globl,-(a7)
		pea.l      4(a7)
		lea.l      10(a7),a1
		movea.l    20(a3),a0
		jsr        mt_objc_offset
		addq.w     #8,a7
		move.w     2(a7),d0
		add.w      52(a3),d0
		movea.l    ACSblk,a0
		add.w      592(a0),d0
		sub.w      52(a2),d0
		move.w     d0,(a4)
		move.w     (a7),d1
		add.w      54(a3),d1
		movea.l    ACSblk,a0
		add.w      594(a0),d1
		sub.w      54(a2),d1
		move.w     d1,(a5)
		move.w     d1,-(a7)
		move.w     (a4),d2
		movea.l    10(a7),a0
		move.w     24(a0),d0
		movea.l    20(a2),a0
		moveq.l    #100,d1
		jsr        Adr_find
		addq.w     #2,a7
		move.w     d0,(a6)
		lea.l      4(a7),a3
		move.w     (a6),d0
		bpl.s      find_parent_1
		move.l     _globl,-(a7)
		pea.l      (a3)
		lea.l      14(a7),a1
		movea.l    16(a7),a0
		move.w     24(a0),d0
		movea.l    20(a2),a0
		jsr        mt_objc_offset
		addq.w     #8,a7
		move.w     (a4),d0
		cmp.w      6(a7),d0
		bge.s      find_parent_2
		clr.w      (a4)
		bra.s      find_parent_3
find_parent_2:
		move.w     6(a7),d0
		sub.w      d0,(a4)
find_parent_3:
		move.w     (a5),d0
		cmp.w      (a3),d0
		bge.s      find_parent_4
		clr.w      (a5)
		bra.s      find_parent_5
find_parent_4:
		move.w     (a3),d0
		sub.w      d0,(a5)
find_parent_5:
		movea.l    8(a7),a0
		move.w     24(a0),(a6)
		bra.s      find_parent_6
find_parent_1:
		move.l     _globl,-(a7)
		pea.l      (a3)
		lea.l      14(a7),a1
		move.w     (a6),d0
		movea.l    20(a2),a0
		jsr        mt_objc_offset
		addq.w     #8,a7
		move.w     6(a7),d0
		sub.w      d0,(a4)
		move.w     (a3),d0
		sub.w      d0,(a5)
find_parent_6:
		lea.l      12(a7),a7
		movem.l    (a7)+,a2-a6
		rts

new_ob:
		movem.l    d3-d7/a2-a5,-(a7)
		lea.l      -26(a7),a7
		movea.l    a0,a4
		move.w     d0,d6
		move.w     d1,d4
		move.l     a1,22(a7)
		movea.l    ACSblk,a0
		move.l     576(a0),18(a7)
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		movea.l    18(a7),a1
		movea.l    20(a1),a0
		lea.l      24(a0,d2.l),a0
		move.l     12(a0),4(a7)
		move.w     18(a0),d5
		movea.l    (a4),a0
		move.w     24(a0),d1
		bmi        new_ob_1
		move.l     (a0),(a7)
		movea.l    (a7),a1
		ori.w      #$0001,6(a1)
		movea.l    4(a0),a2
		movea.l    20(a4),a5
		lea.l      8(a7),a3
		pea.l      14(a7)
		pea.l      20(a7)
		movea.l    a3,a1
		move.w     d6,d0
		movea.l    a4,a0
		bsr        find_parent
		addq.w     #8,a7
		move.w     (a3),d3
new_ob_3:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a5,d0.l),d2
		and.w      #$1000,d2
		beq.s      new_ob_2
		tst.w      d4
		beq        new_ob_1
		move.w     d6,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		andi.w     #$FF7F,8(a5,d0.l)
		ori.w      #$0001,10(a5,d0.l)
		andi.w     #$FF7F,-16(a5,d0.l)
		moveq.l    #-1,d0
		add.w      d6,d0
		movea.l    a4,a0
		jsr        Awi_obredraw
		bra        new_ob_1
new_ob_2:
		move.w     d3,d0
		movea.l    20(a4),a0
		jsr        Aob_up
		move.w     d0,d3
		tst.w      d0
		bpl.s      new_ob_3
		moveq.l    #-2,d1
		add.w      (a3),d1
		ext.l      d1
		divs.w     #$0003,d1
		move.w     d1,(a3)
		tst.w      d4
		bne.s      new_ob_4
		cmpa.l     4(a7),a2
		bne.s      new_ob_4
		cmp.w      d1,d5
		bne.s      new_ob_4
		lea.l      WARN_SAME,a0
		moveq.l    #1,d0
		jsr        Awi_alert
		subq.w     #1,d0
		beq        new_ob_1
new_ob_4:
		move.w     d6,d0
		movea.l    18(a7),a0
		jsr        Adr_del
		tst.w      d4
		beq.s      new_ob_5
		moveq.l    #-2,d3
		add.w      d6,d3
		ext.l      d3
		divs.w     #$0003,d3
		move.w     d3,d0
		movea.l    4(a2),a0
		jsr        free_ob
		bra.s      new_ob_6
new_ob_5:
		move.l     4(a7),-(a7)
		move.w     d5,d0
		movea.l    a2,a1
		movea.l    4(a7),a0
		jsr        copysub_ob
		addq.w     #4,a7
		move.w     d0,d3
new_ob_6:
		movea.l    4(a2),a5
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     (a3),8(a5,d0.l)
		move.w     (a3),d4
		ext.l      d4
		move.l     d4,d2
		lsl.l      #3,d2
		sub.l      d4,d2
		lsl.l      #3,d2
		move.w     12(a5,d2.l),d4
		tst.w      d4
		bmi.s      new_ob_7
		move.w     d4,d6
		ext.l      d6
		move.l     d6,d5
		lsl.l      #3,d5
		sub.l      d6,d5
		lsl.l      #3,d5
		move.w     d3,8(a5,d5.l)
		bra.s      new_ob_8
new_ob_7:
		move.w     (a3),d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     d3,10(a5,d0.l)
new_ob_8:
		move.w     (a3),d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     d3,12(a5,d0.l)
		move.w     16(a7),d4
		move.w     14(a7),d5
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     28(a5,d1.l),d0
		bsr        pixel_x
		move.w     d0,d6
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     30(a5,d1.l),d0
		bsr        pixel_y
		move.w     d0,12(a7)
		move.w     (a3),d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     28(a5,d1.l),d0
		bsr        pixel_x
		move.w     d0,d7
		move.w     (a3),d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     30(a5,d1.l),d0
		bsr        pixel_y
		move.w     d0,10(a7)
		move.w     d4,d1
		add.w      d6,d1
		cmp.w      d1,d7
		bge.s      new_ob_9
		move.w     d7,d4
		sub.w      d6,d4
		tst.w      d4
		bpl.s      new_ob_9
		clr.w      d4
		lea.l      WARN_XSHRINK,a0
		moveq.l    #1,d0
		jsr        Awi_alert
		subq.w     #1,d0
		bne.s      new_ob_9
		move.w     d7,d0
		bsr        char_x
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,28(a5,d1.l)
new_ob_9:
		move.w     d5,d0
		add.w      12(a7),d0
		cmp.w      10(a7),d0
		ble.s      new_ob_10
		move.w     10(a7),d5
		sub.w      12(a7),d5
		tst.w      d5
		bpl.s      new_ob_10
		clr.w      d5
		lea.l      WARN_YSHRINK,a0
		moveq.l    #1,d0
		jsr        Awi_alert
		subq.w     #1,d0
		bne.s      new_ob_10
		move.w     10(a7),d0
		bsr        char_y
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,30(a5,d1.l)
new_ob_10:
		move.w     d4,d0
		bsr        char_x
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,24(a5,d1.l)
		move.w     d5,d0
		bsr        char_y
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,26(a5,d1.l)
		movea.l    22(a7),a0
		addq.w     #1,(a0)
		cmpi.w     #$0005,(a0)
		bge.s      new_ob_1
		move.w     d3,d0
		add.w      d0,d0
		add.w      d3,d0
		addq.w     #1,d0
		move.w     (a0),d4
		ext.l      d4
		add.l      d4,d4
		move.w     d0,0(a0,d4.l)
new_ob_1:
		lea.l      26(a7),a7
		movem.l    (a7)+,d3-d7/a2-a5
		rts

min_size:
		movem.l    a2-a4,-(a7)
		lea.l      -16(a7),a7
		move.l     a0,12(a7)
		movea.l    32(a7),a3
		movea.l    36(a7),a4
		movea.l    ACSblk,a0
		move.w     18(a0),(a3)
		movea.l    ACSblk,a0
		move.w     20(a0),(a4)
		move.l     12(a1),(a7)
		move.b     7(a1),d0
		ext.w      d0
		sub.w      #$0015,d0
		cmp.w      #$000C,d0
		bhi        min_size_1
		add.w      d0,d0
		move.w     J21(pc,d0.w),d0
		jmp        J21(pc,d0.w)
J21:
		dc.w min_size_2-J21
		dc.w min_size_2-J21
		dc.w min_size_3-J21
		dc.w min_size_4-J21
		dc.w min_size_1-J21
		dc.w min_size_5-J21
		dc.w min_size_1-J21
		dc.w min_size_5-J21
		dc.w min_size_6-J21
		dc.w min_size_6-J21
		dc.w min_size_7-J21
		dc.w min_size_5-J21
		dc.w min_size_7-J21
min_size_2:
		movea.l    (a7),a0
		movea.l    (a0),a0
		jsr        strlen
		movea.l    ACSblk,a0
		muls.w     18(a0),d0
		move.w     d0,(a3)
		bra        min_size_1
min_size_6:
		movea.l    (a7),a0
		movea.l    4(a0),a0
		jsr        strlen
		movea.l    ACSblk,a0
		muls.w     18(a0),d0
		move.w     d0,(a3)
		bra        min_size_1
min_size_3:
		movea.l    (a7),a0
		move.w     4(a0),d0
		lsl.w      #3,d0
		add.w      8(a0),d0
		move.w     d0,(a3)
		movea.l    (a7),a0
		move.w     6(a0),d1
		add.w      10(a0),d1
		move.w     d1,(a4)
		bra        min_size_1
min_size_4:
		movea.l    12(a7),a0
		movea.l    20(a0),a1
		move.l     4(a1),4(a7)
		movea.l    4(a7),a0
		movea.l    (a0),a0
		lea.l      22(a0),a0
		jsr        part_get
		move.l     a0,8(a7)
		move.l     a0,d0
		beq.s      min_size_1
		move.l     a4,-(a7)
		movea.l    a3,a1
		movea.l    60(a0),a2
		movea.l    4(a7),a0
		jsr        (a2)
		addq.w     #4,a7
		bra.s      min_size_1
min_size_5:
		movea.l    (a7),a0
		jsr        strlen
		movea.l    ACSblk,a0
		muls.w     18(a0),d0
		move.w     d0,(a3)
		bra.s      min_size_1
min_size_7:
		movea.l    (a7),a0
		move.w     26(a0),d0
		add.w      30(a0),d0
		move.w     18(a0),d1
		add.w      22(a0),d1
		cmp.w      d0,d1
		bge.s      min_size_8
		move.w     d0,d2
		bra.s      min_size_9
min_size_8:
		move.w     d1,d2
min_size_9:
		move.w     d2,(a3)
		movea.l    (a7),a0
		move.w     28(a0),d0
		add.w      32(a0),d0
		move.w     20(a0),d1
		add.w      24(a0),d1
		cmp.w      d0,d1
		bge.s      min_size_10
		move.w     d0,d2
		bra.s      min_size_11
min_size_10:
		move.w     d1,d2
min_size_11:
		move.w     d2,(a4)
min_size_1:
		move.w     (a3),d0
		bgt.s      min_size_12
		movea.l    ACSblk,a0
		move.w     18(a0),(a3)
min_size_12:
		move.w     (a4),d0
		bgt.s      min_size_13
		movea.l    ACSblk,a0
		move.w     20(a0),(a4)
min_size_13:
		lea.l      16(a7),a7
		movem.l    (a7)+,a2-a4
		rts

ob_addselect:
		movem.l    d3-d5/a2-a4,-(a7)
		movea.l    a0,a2
		move.w     d0,d3
		movea.l    20(a2),a3
		lea.l      ACSblk,a4
		movea.l    (a4),a0
		move.w     582(a0),d0
		ble        ob_addselect_1
		move.w     d3,d4
ob_addselect_3:
		move.w     d4,d0
		movea.l    a3,a0
		jsr        Aob_up
		move.w     d0,d4
		tst.w      d0
		ble.s      ob_addselect_2
		moveq.l    #1,d1
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		and.w      10(a3,d2.l),d1
		beq.s      ob_addselect_3
		movea.l    a2,a0
		move.w     d4,d0
		jsr        Adr_del
ob_addselect_2:
		moveq.l    #1,d4
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		add.w      2(a3,d0.l),d4
		tst.w      d4
		ble.w      ob_addselect_1
		bra.s      ob_addselect_4
ob_addselect_9:
		moveq.l    #1,d0
		move.w     d4,d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		and.w      10(a3,d1.l),d0
		beq.s      ob_addselect_5
		movea.l    a2,a0
		move.w     d4,d0
		jsr        Adr_del
		movea.l    (a4),a0
		move.w     582(a0),d0
		beq.s      ob_addselect_1
ob_addselect_5:
		moveq.l    #1,d5
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		add.w      2(a3,d0.l),d5
		cmp.w      #$0001,d5
		bge.s      ob_addselect_6
		bra.s      ob_addselect_7
ob_addselect_8:
		move.w     d5,d4
ob_addselect_7:
		move.w     d4,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     0(a3,d0.l),d5
		cmp.w      d5,d3
		beq.s      ob_addselect_6
		move.w     d5,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		cmp.w      4(a3,d2.l),d4
		beq.s      ob_addselect_8
ob_addselect_6:
		move.w     d5,d4
ob_addselect_4:
		cmp.w      d4,d3
		bne.s      ob_addselect_9
ob_addselect_1:
		move.w     d3,d0
		movea.l    a2,a0
		jsr        Adr_add
		movea.l    (a2),a0
		moveq.l    #-2,d0
		add.w      d3,d0
		ext.l      d0
		divs.w     #$0003,d0
		move.w     d0,10(a0)
		movem.l    (a7)+,d3-d5/a2-a4
		rts

edob_next:
		movem.l    d3-d5/a2-a4,-(a7)
		lea.l      ACSblk,a2
		movea.l    (a2),a0
		movea.l    600(a0),a1
		movea.l    (a1),a3
		move.w     10(a3),d3
		tst.w      d3
		bmi        edob_next_1
		move.w     24(a3),d0
		bmi        edob_next_1
		moveq.l    #-2,d4
		add.w      d0,d4
		ext.l      d4
		divs.w     #$0003,d4
		movea.l    4(a3),a0
		movea.l    4(a0),a4
		movea.l    (a2),a1
		cmpi.w     #$0001,582(a1)
		bne        edob_next_2
		movea.l    576(a1),a0
		cmpa.l     600(a1),a0
		bne        edob_next_2
edob_next_11:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     18(a4,d0.l),d2
		and.w      #$1000,d2
		bne.s      edob_next_3
		cmp.w      d3,d4
		beq.s      edob_next_4
		move.w     #$0080,d0
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		and.w      16(a4,d1.l),d0
		beq.s      edob_next_4
edob_next_3:
		moveq.l    #-1,d5
		bra.s      edob_next_5
edob_next_4:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a4,d0.l),d5
edob_next_5:
		tst.w      d5
		bpl.s      edob_next_6
		bra.s      edob_next_7
edob_next_8:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		move.w     8(a4,d0.l),d5
		tst.w      d5
		bmi.s      edob_next_6
		move.w     d5,d0
		ext.l      d0
		move.l     d0,d2
		lsl.l      #3,d2
		sub.l      d0,d2
		lsl.l      #3,d2
		cmp.w      12(a4,d2.l),d3
		bne.s      edob_next_6
		move.w     d5,d3
edob_next_7:
		cmp.w      d3,d4
		bne.s      edob_next_8
edob_next_6:
		tst.w      d5
		bpl.s      edob_next_9
		move.w     d4,d3
		bra.s      edob_next_10
edob_next_9:
		move.w     d5,d3
edob_next_10:
		cmp.w      d3,d4
		beq.s      edob_next_2
		move.w     #$0080,d0
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		and.w      16(a4,d1.l),d0
		bne        edob_next_11
edob_next_2:
		move.w     d3,10(a3)
		jsr        Adr_unselect
		move.w     d3,d0
		add.w      d0,d0
		add.w      d3,d0
		addq.w     #2,d0
		movea.l    (a2),a0
		movea.l    600(a0),a0
		jsr        Adr_add
edob_next_1:
		movem.l    (a7)+,d3-d5/a2-a4
		rts

rubberbox:
		movem.l    d3-d7/a2-a6,-(a7)
		lea.l      -86(a7),a7
		move.w     d0,84(a7)
		move.w     d1,d5
		move.w     d2,d6
		movea.l    a1,a3
		movea.l    130(a7),a2
		movea.l    ACSblk,a1
		move.w     18(a1),d1
		asr.w      #1,d1
		move.w     d1,56(a7)
		move.w     20(a1),d2
		asr.w      #1,d2
		move.w     d2,54(a7)
		move.l     (a0),8(a7)
		movea.l    20(a0),a4
		lea.l      INFO_OB_WH,a0
		jsr        Aob_create
		movea.l    a0,a5
		move.l     a5,d0
		beq        rubberbox_1
		jsr        Aob_fix
		move.w     d5,d0
		sub.w      20(a5),d0
		move.w     d0,16(a5)
		move.w     d6,d1
		sub.w      22(a5),d1
		move.w     d1,18(a5)
		move.w     16(a5),d0
		bmi.s      rubberbox_2
		tst.w      d1
		bpl.s      rubberbox_3
rubberbox_2:
		movea.l    a5,a0
		jsr        Aob_delete
		suba.l     a5,a5
		bra        rubberbox_1
rubberbox_3:
		move.w     22(a5),d1
		move.w     20(a5),d0
		jsr        Abp_create
		move.l     a0,24(a7)
		beq.s      rubberbox_1
		move.w     16(a5),d0
		move.w     d0,28(a7)
		moveq.l    #-1,d1
		add.w      20(a5),d1
		move.w     d1,40(a7)
		add.w      d1,d0
		move.w     d0,32(a7)
		move.w     18(a5),d1
		move.w     d1,30(a7)
		moveq.l    #-1,d0
		add.w      22(a5),d0
		move.w     d0,42(a7)
		add.w      d0,d1
		move.w     d1,34(a7)
		clr.w      d0
		move.w     d0,38(a7)
		move.w     d0,36(a7)
		jsr        Amo_hide
		move.l     24(a7),-(a7)
		movea.l    ACSblk,a1
		lea.l      618(a1),a1
		lea.l      32(a7),a0
		moveq.l    #3,d1
		movea.l    ACSblk,a6
		move.w     16(a6),d0
		jsr        vro_cpyfm
		addq.w     #4,a7
		jsr        Amo_show
rubberbox_1:
		movea.l    8(a7),a0
		movea.l    4(a0),a1
		move.l     4(a1),4(a7)
		moveq.l    #-2,d1
		add.w      84(a7),d1
		ext.l      d1
		divs.w     #$0003,d1
		ext.l      d1
		move.l     d1,d0
		lsl.l      #3,d0
		sub.l      d1,d0
		lsl.l      #3,d0
		movea.l    4(a7),a6
		adda.l     d0,a6
		move.l     a6,(a7)
		movea.l    ACSblk,a0
		movea.l    572(a0),a0
		lea.l      68(a0),a0
		jsr        Amo_new
		pea.l      80(a7)
		pea.l      86(a7)
		move.w     92(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		lea.l      -24(a4,d0.l),a1
		movea.l    8(a7),a0
		bsr        min_size
		addq.w     #8,a7
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     2(a4,d0.l),d3
		tst.w      d3
		ble        rubberbox_4
		moveq.l    #64,d2
		and.w      10(a4,d0.l),d2
		bne        rubberbox_4
rubberbox_17:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a4,d0.l),d2
		and.w      #$0300,d2
		tst.w      d2
		beq.s      rubberbox_5
		sub.w      #$0100,d2
		beq        rubberbox_6
		sub.w      #$0100,d2
		beq.s      rubberbox_7
		sub.w      #$0100,d2
		beq.s      rubberbox_8
		bra        rubberbox_9
rubberbox_5:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     16(a4,d0.l),d4
		add.w      20(a4,d0.l),d4
		bra        rubberbox_9
rubberbox_7:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     20(a4,d0.l),d4
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      16(a4,d2.l),d4
		move.w     16(a4,d2.l),d1
		add.w      20(a4,d2.l),d1
		move.w     d1,74(a7)
		cmp.w      d1,d4
		bge.s      rubberbox_9
		move.w     d1,d4
		bra.s      rubberbox_9
rubberbox_8:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     20(a4,d0.l),d4
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      16(a4,d2.l),d4
		bra.s      rubberbox_9
rubberbox_6:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     20(a4,d0.l),d4
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      20(a4,d2.l),d4
		movea.l    ACSblk,a0
		add.w      18(a0),d4
rubberbox_9:
		cmp.w      82(a7),d4
		ble.s      rubberbox_10
		move.w     d4,82(a7)
rubberbox_10:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     10(a4,d0.l),d2
		and.w      #$0C00,d2
		tst.w      d2
		beq.s      rubberbox_11
		sub.w      #$0400,d2
		beq        rubberbox_12
		sub.w      #$0400,d2
		beq.s      rubberbox_13
		sub.w      #$0400,d2
		beq.s      rubberbox_14
		bra        rubberbox_15
rubberbox_11:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     18(a4,d0.l),d7
		add.w      22(a4,d0.l),d7
		bra        rubberbox_15
rubberbox_13:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     22(a4,d0.l),d7
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      18(a4,d2.l),d7
		move.w     18(a4,d2.l),d1
		add.w      22(a4,d2.l),d1
		move.w     d1,74(a7)
		cmp.w      d1,d7
		bge.s      rubberbox_15
		move.w     d1,d7
		bra.s      rubberbox_15
rubberbox_14:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     22(a4,d0.l),d7
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      18(a4,d2.l),d7
		bra.s      rubberbox_15
rubberbox_12:
		move.w     84(a7),d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     22(a4,d0.l),d7
		move.w     d3,d0
		ext.l      d0
		move.l     d0,d2
		add.l      d2,d2
		add.l      d0,d2
		lsl.l      #3,d2
		sub.w      22(a4,d2.l),d7
		movea.l    ACSblk,a0
		add.w      20(a0),d7
rubberbox_15:
		cmp.w      80(a7),d7
		ble.s      rubberbox_16
		move.w     d7,80(a7)
rubberbox_16:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     24(a4,d0.l),d3
		cmp.w      84(a7),d3
		bne        rubberbox_17
rubberbox_4:
		add.w      d5,82(a7)
		add.w      d6,80(a7)
		clr.w      d0
		move.w     d0,46(a7)
		move.w     d0,44(a7)
		movea.l    ACSblk,a0
		move.w     8(a0),d1
		add.w      12(a0),d1
		move.w     d1,48(a7)
		move.w     10(a0),d0
		add.w      14(a0),d0
		move.w     d0,50(a7)
		lea.l      44(a7),a0
		movea.l    ACSblk,a1
		move.w     16(a1),d0
		moveq.l    #1,d1
		jsr        vs_clip
		movea.l    8(a7),a0
		move.w     84(a7),d0
		cmp.w      24(a0),d0
		beq.s      rubberbox_18
		movea.l    a4,a0
		jsr        Aob_up
		move.w     d0,52(a7)
		move.w     84(a7),d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		move.w     16(a4,d1.l),72(a7)
		move.w     18(a4,d1.l),70(a7)
		move.w     d5,d0
		move.w     52(a7),d1
		ext.l      d1
		move.l     d1,d2
		add.l      d2,d2
		add.l      d1,d2
		lsl.l      #3,d2
		add.w      20(a4,d2.l),d0
		sub.w      72(a7),d0
		move.w     d0,78(a7)
		move.w     d6,d0
		add.w      22(a4,d2.l),d0
		sub.w      70(a7),d0
		move.w     d0,76(a7)
		bra.s      rubberbox_19
rubberbox_18:
		move.w     #$7530,d0
		move.w     d0,76(a7)
		move.w     d0,78(a7)
rubberbox_19:
		move.l     _globl,-(a7)
		pea.l      70(a7)
		pea.l      76(a7)
		lea.l      70(a7),a1
		lea.l      72(a7),a0
		jsr        mt_graf_mkstate
		lea.l      12(a7),a7
rubberbox_45:
		move.w     snapping,d0
		beq.s      rubberbox_20
		move.w     60(a7),d1
		sub.w      d5,d1
		add.w      56(a7),d1
		ext.l      d1
		movea.l    ACSblk,a0
		divs.w     18(a0),d1
		muls.w     18(a0),d1
		add.w      d5,d1
		move.w     d1,60(a7)
		move.w     58(a7),d2
		sub.w      d6,d2
		add.w      54(a7),d2
		ext.l      d2
		divs.w     20(a0),d2
		muls.w     20(a0),d2
		add.w      d6,d2
		move.w     d2,58(a7)
rubberbox_20:
		move.w     60(a7),(a3)
		move.w     58(a7),(a2)
		moveq.l    #4,d0
		and.w      66(a7),d0
		bne        rubberbox_21
		move.w     (a3),d1
		cmp.w      78(a7),d1
		ble.s      rubberbox_22
		move.w     78(a7),(a3)
rubberbox_22:
		move.w     (a2),d0
		cmp.w      76(a7),d0
		ble.s      rubberbox_23
		move.w     76(a7),(a2)
rubberbox_23:
		move.w     (a3),d0
		cmp.w      82(a7),d0
		bge.s      rubberbox_24
		move.w     82(a7),(a3)
rubberbox_24:
		move.w     (a2),d0
		cmp.w      80(a7),d0
		bge.s      rubberbox_25
		move.w     80(a7),(a2)
rubberbox_25:
		movea.l    8(a7),a0
		move.w     84(a7),d0
		cmp.w      24(a0),d0
		beq        rubberbox_26
		move.w     52(a7),d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		move.w     2(a4,d1.l),d3
rubberbox_32:
		cmp.w      84(a7),d3
		beq        rubberbox_27
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     16(a4,d0.l),d4
		add.w      20(a4,d0.l),d4
		move.w     18(a4,d0.l),d7
		add.w      22(a4,d0.l),d7
		cmp.w      72(a7),d4
		ble.w      rubberbox_27
		cmp.w      70(a7),d7
		ble.w      rubberbox_27
		move.w     d5,d4
		sub.w      72(a7),d4
		add.w      16(a4,d0.l),d4
		move.w     d6,d7
		sub.w      70(a7),d7
		add.w      18(a4,d0.l),d7
		cmp.w      (a3),d4
		bge.s      rubberbox_28
		cmp.w      d7,d6
		bge.s      rubberbox_29
		cmp.w      (a2),d7
		bge.s      rubberbox_28
		cmp.w      80(a7),d7
		blt.s      rubberbox_28
		move.w     60(a7),d2
		sub.w      d4,d2
		movea.w    58(a7),a0
		suba.w     d7,a0
		cmp.w      a0,d2
		bge.s      rubberbox_30
		cmp.w      82(a7),d4
		bge.s      rubberbox_28
rubberbox_30:
		move.w     d7,(a2)
		bra.s      rubberbox_28
rubberbox_29:
		cmp.w      (a3),d4
		bge.s      rubberbox_28
		cmp.w      82(a7),d4
		blt.s      rubberbox_28
		move.w     d4,(a3)
rubberbox_28:
		cmp.w      (a2),d7
		bge.s      rubberbox_27
		cmp.w      d4,d5
		bge.s      rubberbox_31
		cmp.w      (a3),d4
		bge.s      rubberbox_27
		cmp.w      82(a7),d4
		blt.s      rubberbox_27
		move.w     d4,(a3)
		bra.s      rubberbox_27
rubberbox_31:
		cmp.w      (a2),d7
		bge.s      rubberbox_27
		cmp.w      80(a7),d7
		blt.s      rubberbox_27
		move.w     d7,(a2)
rubberbox_27:
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     24(a4,d0.l),d3
		cmp.w      52(a7),d3
		bne        rubberbox_32
		bra.s      rubberbox_26
rubberbox_21:
		move.w     (a3),d0
		move.w     d5,d1
		movea.l    ACSblk,a0
		add.w      18(a0),d1
		cmp.w      d1,d0
		bge.s      rubberbox_33
		move.w     d1,(a3)
rubberbox_33:
		move.w     (a2),d0
		move.w     d6,d1
		movea.l    ACSblk,a0
		add.w      20(a0),d1
		cmp.w      d1,d0
		bge.s      rubberbox_26
		move.w     d1,(a2)
rubberbox_26:
		subq.w     #1,(a3)
		subq.w     #1,(a2)
		moveq.l    #1,d0
		and.w      68(a7),d0
		beq.s      rubberbox_34
		moveq.l    #2,d1
		and.w      68(a7),d1
		beq        rubberbox_35
rubberbox_34:
		lea.l      44(a7),a0
		clr.w      d1
		movea.l    ACSblk,a1
		move.w     16(a1),d0
		jsr        vs_clip
		sub.w      d5,(a3)
		sub.w      d6,(a2)
		movea.l    ACSblk,a0
		movea.l    572(a0),a0
		lea.l      56(a0),a0
		jsr        Amo_new
		move.l     a5,d0
		beq        rubberbox_36
		move.l     24(a7),d1
		beq.s      rubberbox_37
		move.w     16(a5),d2
		move.w     d2,36(a7)
		moveq.l    #-1,d0
		add.w      20(a5),d0
		move.w     d0,32(a7)
		add.w      d0,d2
		move.w     d2,40(a7)
		move.w     18(a5),d0
		move.w     d0,38(a7)
		moveq.l    #-1,d2
		add.w      22(a5),d2
		move.w     d2,34(a7)
		add.w      d2,d0
		move.w     d0,42(a7)
		clr.w      d2
		move.w     d2,30(a7)
		move.w     d2,28(a7)
		jsr        Amo_hide
		movea.l    ACSblk,a0
		pea.l      618(a0)
		movea.l    28(a7),a1
		lea.l      32(a7),a0
		moveq.l    #3,d1
		movea.l    ACSblk,a6
		move.w     16(a6),d0
		jsr        vro_cpyfm
		addq.w     #4,a7
		jsr        Amo_show
		movea.l    24(a7),a0
		jsr        Abp_delete
		bra.s      rubberbox_38
rubberbox_37:
		move.w     18(a5),d0
		add.w      22(a5),d0
		subq.w     #1,d0
		move.w     d0,-(a7)
		move.w     16(a5),d1
		add.w      20(a5),d1
		subq.w     #1,d1
		move.w     d1,-(a7)
		move.w     18(a5),-(a7)
		move.w     16(a5),-(a7)
		move.w     d0,-(a7)
		move.w     d1,-(a7)
		movea.l    _globl,a0
		move.w     18(a5),d2
		move.w     16(a5),d1
		moveq.l    #3,d0
		jsr        mt_form_dial
		lea.l      12(a7),a7
rubberbox_38:
		movea.l    a5,a0
		jsr        Aob_delete
rubberbox_36:
		jsr        Aev_release
		moveq.l    #2,d0
		and.w      68(a7),d0
		beq.s      rubberbox_39
		clr.w      d0
		bra        rubberbox_40
rubberbox_39:
		moveq.l    #1,d0
		bra        rubberbox_40
rubberbox_35:
		movea.l    _globl,a1
		suba.l     a0,a0
		move.w     #$0100,d0
		jsr        mt_graf_mouse
		moveq.l    #3,d1
		movea.l    ACSblk,a0
		move.w     16(a0),d0
		jsr        vswr_mode
		moveq.l    #1,d1
		movea.l    ACSblk,a0
		move.w     16(a0),d0
		jsr        vsl_color
		move.w     d6,d2
		move.w     (a3),d1
		move.w     d5,d0
		jsr        dotted_xline
		move.w     (a2),d2
		move.w     (a3),d1
		move.w     d5,d0
		jsr        dotted_xline
		move.w     d5,d2
		move.w     (a2),d1
		move.w     d6,d0
		jsr        dotted_yline
		move.w     (a3),d2
		move.w     (a2),d1
		move.w     d6,d0
		jsr        dotted_yline
		move.l     a5,d0
		beq        rubberbox_41
		move.w     (a2),d1
		sub.w      d6,d1
		addq.w     #1,d1
		ext.l      d1
		movea.l    ACSblk,a0
		divs.w     20(a0),d1
		move.w     d1,-(a7)
		move.w     (a3),d2
		sub.w      d5,d2
		addq.w     #1,d2
		ext.l      d2
		divs.w     18(a0),d2
		move.w     d2,-(a7)
		lea.l      xc91c8,a1
		lea.l      16(a7),a0
		jsr        sprintf
		addq.w     #4,a7
		lea.l      12(a7),a1
		moveq.l    #1,d0
		movea.l    a5,a0
		jsr        Aob_puttext
		move.w     (a2),d0
		sub.w      d6,d0
		addq.w     #1,d0
		move.w     d0,-(a7)
		move.w     (a3),d1
		sub.w      d5,d1
		addq.w     #1,d1
		move.w     d1,-(a7)
		lea.l      xc91c8,a1
		lea.l      16(a7),a0
		jsr        sprintf
		addq.w     #4,a7
		lea.l      12(a7),a1
		moveq.l    #2,d0
		movea.l    a5,a0
		jsr        Aob_puttext
		move.w     18(a5),d0
		add.w      22(a5),d0
		subq.w     #1,d0
		move.w     d0,-(a7)
		move.w     16(a5),d1
		add.w      20(a5),d1
		subq.w     #1,d1
		move.w     d1,-(a7)
		move.w     18(a5),-(a7)
		movea.l    _globl,a1
		move.w     16(a5),d2
		movea.l    a5,a0
		clr.w      d0
		moveq.l    #2,d1
		jsr        mt_objc_draw
		addq.w     #6,a7
rubberbox_41:
		movea.l    _globl,a1
		suba.l     a0,a0
		move.w     #$0101,d0
		jsr        mt_graf_mouse
rubberbox_44:
		move.l     _globl,-(a7)
		pea.l      70(a7)
		pea.l      76(a7)
		lea.l      74(a7),a1
		lea.l      76(a7),a0
		jsr        mt_graf_mkstate
		lea.l      12(a7),a7
		moveq.l    #1,d0
		and.w      68(a7),d0
		beq.s      rubberbox_42
		moveq.l    #2,d1
		and.w      68(a7),d1
		bne.s      rubberbox_42
		move.w     snapping,d2
		beq.s      rubberbox_43
		movea.w    64(a7),a0
		suba.w     60(a7),a0
		cmpa.w     56(a7),a0
		bgt.s      rubberbox_42
		movea.w    60(a7),a1
		suba.w     64(a7),a1
		cmpa.w     56(a7),a1
		bgt.s      rubberbox_42
		movea.w    62(a7),a6
		suba.w     58(a7),a6
		cmpa.w     54(a7),a6
		bgt.s      rubberbox_42
		move.w     58(a7),d0
		sub.w      62(a7),d0
		cmp.w      54(a7),d0
		ble.s      rubberbox_44
		bra.s      rubberbox_42
rubberbox_43:
		move.w     64(a7),d0
		cmp.w      60(a7),d0
		bne.s      rubberbox_42
		move.w     62(a7),d1
		cmp.w      58(a7),d1
		beq        rubberbox_44
rubberbox_42:
		movea.l    _globl,a1
		suba.l     a0,a0
		move.w     #$0100,d0
		jsr        mt_graf_mouse
		moveq.l    #3,d1
		movea.l    ACSblk,a0
		move.w     16(a0),d0
		jsr        vswr_mode
		moveq.l    #1,d1
		movea.l    ACSblk,a0
		move.w     16(a0),d0
		jsr        vsl_color
		move.w     d6,d2
		move.w     (a3),d1
		move.w     d5,d0
		jsr        dotted_xline
		move.w     (a2),d2
		move.w     (a3),d1
		move.w     d5,d0
		jsr        dotted_xline
		move.w     d5,d2
		move.w     (a2),d1
		move.w     d6,d0
		jsr        dotted_yline
		move.w     (a3),d2
		move.w     (a2),d1
		move.w     d6,d0
		jsr        dotted_yline
		movea.l    _globl,a1
		suba.l     a0,a0
		move.w     #$0101,d0
		jsr        mt_graf_mouse
		move.w     64(a7),60(a7)
		move.w     62(a7),58(a7)
		bra        rubberbox_45
rubberbox_40:
		lea.l      86(a7),a7
		movem.l    (a7)+,d3-d7/a2-a6
		rts

sizing:
		movem.l    d3-d7/a2-a6,-(a7)
		lea.l      -20(a7),a7
		movea.l    a0,a2
		move.w     d0,d3
		move.w     d1,d6
		move.w     d2,d5
		movea.l    20(a2),a3
		move.l     _globl,-(a7)
		pea.l      20(a7)
		lea.l      26(a7),a1
		movea.l    a3,a0
		jsr        mt_objc_offset
		addq.w     #8,a7
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		move.w     20(a3,d0.l),d4
		move.w     22(a3,d0.l),d7
		lea.l      14(a7),a4
		move.w     52(a2),d0
		add.w      18(a7),d0
		add.w      d4,d0
		sub.w      d6,d0
		move.w     d0,(a4)
		lea.l      12(a7),a5
		move.w     54(a2),d0
		add.w      16(a7),d0
		add.w      d7,d0
		sub.w      d5,d0
		move.w     d0,(a5)
		cmpi.w     #$0008,(a4)
		ble.s      sizing_1
		move.w     d4,d1
		asr.w      #3,d1
		move.w     (a4),d2
		cmp.w      d1,d2
		bgt.s      sizing_2
sizing_1:
		cmpi.w     #$0008,(a5)
		ble.s      sizing_3
		move.w     d7,d0
		asr.w      #3,d0
		move.w     (a5),d1
		cmp.w      d0,d1
		ble.s      sizing_3
sizing_2:
		moveq.l    #-1,d0
		bra        sizing_4
sizing_3:
		pea.l      (a5)
		movea.l    a4,a1
		move.w     54(a2),d2
		add.w      20(a7),d2
		move.w     52(a2),d1
		add.w      22(a7),d1
		move.w     d3,d0
		movea.l    a2,a0
		bsr        rubberbox
		addq.w     #4,a7
		tst.w      d0
		beq        sizing_5
		move.l     (a2),8(a7)
		movea.l    8(a7),a0
		movea.l    (a0),a1
		ori.w      #$0001,6(a1)
		move.l     4(a0),4(a7)
		movea.l    4(a7),a1
		move.l     4(a1),(a7)
		moveq.l    #-2,d5
		add.w      d3,d5
		ext.l      d5
		divs.w     #$0003,d5
		move.w     (a4),d6
		sub.w      d4,d6
		move.w     (a5),d0
		sub.w      d7,d0
		move.w     d0,d7
		move.w     d7,d2
		move.w     d6,d1
		movea.l    (a7),a0
		move.w     d5,d0
		movea.l    a3,a1
		jsr        resize_ob
		move.w     snapping,d0
		beq.s      sizing_6
		movea.l    ACSblk,a0
		move.w     18(a0),d1
		asr.w      #1,d1
		subq.w     #1,d1
		add.w      d1,(a4)
		move.w     20(a0),d2
		asr.w      #1,d2
		subq.w     #1,d2
		add.w      d2,(a5)
sizing_6:
		move.w     (a4),d0
		bsr        char_x
		move.w     d0,(a4)
		move.w     (a5),d0
		bsr        char_y
		move.w     d0,(a5)
		move.w     d5,d2
		ext.l      d2
		move.l     d2,d1
		lsl.l      #3,d1
		sub.l      d2,d1
		lsl.l      #3,d1
		movea.l    (a7),a0
		move.w     (a4),28(a0,d1.l)
		move.w     (a5),30(a0,d1.l)
		tst.w      d5
		bne.s      sizing_7
		movea.l    16(a2),a1
		movea.l    a2,a0
		jsr        (a1)
		ori.w      #$0010,86(a2)
		lea.l      36(a2),a1
		movea.l    a2,a0
		movea.l    134(a2),a6
		jsr        (a6)
		move.w     d3,d0
		movea.l    a2,a0
		jsr        Adr_add
		bra        sizing_5
sizing_7:
		move.w     d3,d0
		movea.l    a2,a0
		jsr        undraw
		move.w     d3,d1
		ext.l      d1
		move.l     d1,d0
		add.l      d0,d0
		add.l      d1,d0
		lsl.l      #3,d0
		movea.l    20(a2),a0
		andi.w     #$FF7F,-16(a0,d0.l)
		movea.l    20(a2),a0
		andi.w     #$FF7F,8(a0,d0.l)
		move.w     (a4),d0
		bsr        pixel_x
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,-4(a3,d1.l)
		move.w     d0,20(a3,d1.l)
		move.w     (a5),d0
		bsr        pixel_y
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d1
		add.l      d1,d1
		add.l      d2,d1
		lsl.l      #3,d1
		move.w     d0,-2(a3,d1.l)
		move.w     d0,22(a3,d1.l)
		moveq.l    #-1,d0
		add.w      d3,d0
		movea.l    a2,a0
		jsr        Awi_obredraw
		moveq.l    #1,d1
		move.w     d3,d2
		ext.l      d2
		move.l     d2,d0
		add.l      d0,d0
		add.l      d2,d0
		lsl.l      #3,d0
		or.w       10(a3,d0.l),d1
		movea.l    a2,a0
		movea.l    102(a2),a1
		move.w     d3,d0
		jsr        (a1)
sizing_5:
		clr.w      d0
sizing_4:
		lea.l      20(a7),a7
		movem.l    (a7)+,d3-d7/a2-a6
		rts

undraw:
		movem.l    d3/a2-a3,-(a7)
		movea.l    a0,a2
		move.w     d0,d3
		movea.l    20(a2),a3
		ext.l      d0
		move.l     d0,d1
		add.l      d1,d1
		add.l      d0,d1
		lsl.l      #3,d1
		ori.w      #$0080,8(a3,d1.l)
		andi.w     #$FFFE,10(a3,d1.l)
		ori.w      #$0080,-16(a3,d1.l)
		moveq.l    #-1,d0
		add.w      d3,d0
		jsr        Awi_obredraw
		movem.l    (a7)+,d3/a2-a3
		rts

	.data

xc91c8:
		dc.b '%d*%d',0
		.even
