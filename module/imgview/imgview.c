#include <string.h>
#include <stdio.h>
#include "acs.h"
#include "acs230.h"
#include "acsplus.h"
#include "../src/country.h"

#ifndef UNUSED
# define UNUSED(x) ((void)(x))
#endif

static void pic_click(void);
static void pic_click2(void);

static boolean main_service(Awindow *self, int16 task, void *in_out);
static Awindow *main_create(void *para);
static int16 main_open(Awindow *self);

static boolean view_service(Awindow *self, int16 task, void *in_out);
static Awindow *view_create(void *para);

#if COUNTRY == COUNTRY_DE
static char TEXT_01[] = "OK";
static char TEXT_02[] = "";
static char TEXT_03[] = "X:";
static char TEXT_04[] = "Abbruch";
static char TEXT_05[] = "Diese Ikone startet einen weiteren IMG-Viewer. Ein weiteres ACS 2.00 Modul";
static char TEXT_06[] = "IMG VIEWER";
static char TEXT_07[] = "W:";
static char TEXT_08[] = "1234";
static char TEXT_09[] = "Y:";
static char TEXT_10[] = "H:";
static char TEXT_11[] = "____";
static char TEXT_12[] = "NNNN";
static char TEXT_13[] = " Ausma\236e ";
static char TEXT_14[] = " Information ";
static char TEXT_15[] = "IMG-Datei \224ffnen";
#endif

#if COUNTRY == COUNTRY_US
static char TEXT_01[] = "OK";
static char TEXT_02[] = "";
static char TEXT_03[] = "X:";
static char TEXT_04[] = "Cancel";
static char TEXT_05[] = "This icon starts another IMG-Viewer. Another ACS 2.00 module";
static char TEXT_06[] = "IMG VIEWER";
static char TEXT_07[] = "W:";
static char TEXT_08[] = "1234";
static char TEXT_09[] = "Y:";
static char TEXT_10[] = "H:";
static char TEXT_11[] = "____";
static char TEXT_12[] = "NNNN";
static char TEXT_13[] = " Dimensions ";
static char TEXT_14[] = " Information ";
static char TEXT_15[] = "Open IMG-file";
#endif


static int16 DATAS_01[] = {
	0x003d, 0xba12, 76, 53, 5, 1, 4, 0, 0, 0, /* MFDB org */
	0, 0, /* MFDB *trans */
	0, 0, /* long count */
	0x1083, 0x4284, 0x1a14, 0x20d0, 0xa106,
	0x1191, 0x268c, 0x8934, 0x6449, 0xa322,
	0x0ece, 0x1a76, 0x70d3, 0xb386, 0x9d9c,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0x1f1f,
	0x0303, 0x0382, 0x0000, 0x030f, 0x8303,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0xdf1f,
	0x3f3f, 0x3fbe, 0x0000, 0x073f, 0xff3f,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xfb33,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xff33,
	0x3f3f, 0x3fbe, 0xf0e1, 0xa03f, 0x7f3f,
	0x1f1f, 0x1f9f, 0x0912, 0x601f, 0x1f1f,
	0x0000, 0x0380, 0x0904, 0x2000, 0x0f80,
	0x0000, 0x0380, 0xf8e4, 0x2600, 0x0780,
	0x0000, 0x0001, 0x0834, 0x2600, 0x0000,
	0x0000, 0x0001, 0x1912, 0x6600, 0x0000,
	0xffc0, 0x0000, 0xece1, 0xa600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0x000f, 0x8f8e, 0x0000, 0x068f, 0x8f8f,
	0x001f, 0x9f00, 0x0000, 0x001f, 0x9f9f,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0010, 0x0019, 0x9999,
	0x001f, 0x9f00, 0x0010, 0x001f, 0x9f9f,
	0x000f, 0x8f78, 0x70d3, 0xc38f, 0x8f8f,
	0x0001, 0x8184, 0x8934, 0x2441, 0x8181,
	0x0001, 0x8104, 0x8210, 0x2401, 0x8181,
	0x0000, 0x007c, 0x7213, 0xe39f, 0xc1ff,
	0x0000, 0x0084, 0x1a14, 0x20df, 0xc07f,
	0x0000, 0x008c, 0x8934, 0x645f, 0xc007,
	0x0000, 0x0076, 0x70d3, 0xb39f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00fd, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f3, 0x8000,
	0x0000, 0x000f, 0x0e1a, 0x78f3, 0x8000,
	0x0000, 0x0010, 0x9126, 0x84f3, 0x8000,
	0x0000, 0x0000, 0x9042, 0x04f3, 0x8000,
	0x0000, 0x000f, 0x8e42, 0x7ce3, 0x8000,
	0x0000, 0x0010, 0x8342, 0x84e3, 0x8000,
	0x0000, 0x0011, 0x9126, 0x8ce3, 0x8000,
	0x1083, 0x4284, 0x1a14, 0x20d0, 0xa106,
	0x1191, 0x268c, 0x8934, 0x6449, 0xa322,
	0x0ece, 0x1a76, 0x70d3, 0xb386, 0x9d9c,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0x1f1f,
	0x0303, 0x0382, 0x0000, 0x030f, 0x8303,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0xdf1f,
	0x3f3f, 0x3fbe, 0x0000, 0x073f, 0xff3f,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xfb33,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xff33,
	0x3f3f, 0x3fbe, 0xf0e1, 0xa03f, 0x7f3f,
	0x1f1f, 0x1f9f, 0x0912, 0x601f, 0x1f1f,
	0x0000, 0x0380, 0x0904, 0x2000, 0x0f80,
	0x0000, 0x0380, 0xf8e4, 0x2600, 0x0780,
	0x0000, 0x0001, 0x0834, 0x2600, 0x0000,
	0x0000, 0x0001, 0x1912, 0x6600, 0x0000,
	0xffc0, 0x0000, 0xece1, 0xa600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0x000f, 0x8f8e, 0x0000, 0x068f, 0x8f8f,
	0x001f, 0x9f00, 0x0000, 0x001f, 0x9f9f,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0010, 0x0019, 0x9999,
	0x001f, 0x9f00, 0x0010, 0x001f, 0x9f9f,
	0x000f, 0x8f78, 0x70d3, 0xc38f, 0x8f8f,
	0x0001, 0x8184, 0x8934, 0x2441, 0x8181,
	0x0001, 0x8104, 0x8210, 0x2401, 0x8181,
	0x0000, 0x007c, 0x7213, 0xe39f, 0xc1ff,
	0x0000, 0x0084, 0x1a14, 0x20df, 0xc07f,
	0x0000, 0x008c, 0x8934, 0x645f, 0xc007,
	0x0000, 0x0076, 0x70d3, 0xb39f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00fd, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f3, 0x8000,
	0x0000, 0x000f, 0x0e1a, 0x78f3, 0x8000,
	0x0000, 0x0010, 0x9126, 0x84f3, 0x8000,
	0x0000, 0x0000, 0x9042, 0x04f3, 0x8000,
	0x0000, 0x000f, 0x8e42, 0x7ce3, 0x8000,
	0x0000, 0x0010, 0x8342, 0x84e3, 0x8000,
	0x0000, 0x0011, 0x9126, 0x8ce3, 0x8000,
	0x1083, 0x4284, 0x1a14, 0x20d0, 0xa106,
	0x1191, 0x268c, 0x8934, 0x6449, 0xa322,
	0x0ece, 0x1a76, 0x70d3, 0xb386, 0x9d9c,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0x1f1f,
	0x0303, 0x0382, 0x0000, 0x030f, 0x8303,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0xdf1f,
	0x3f3f, 0x3fbe, 0x0000, 0x073f, 0xff3f,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xfb33,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xff33,
	0x3f3f, 0x3fbe, 0xf0e1, 0xa03f, 0x7f3f,
	0x1f1f, 0x1f9f, 0x0912, 0x601f, 0x1f1f,
	0x0000, 0x0380, 0x0904, 0x2000, 0x0f80,
	0x0000, 0x0380, 0xf8e4, 0x2600, 0x0780,
	0x0000, 0x0001, 0x0834, 0x2600, 0x0000,
	0x0000, 0x0001, 0x1912, 0x6600, 0x0000,
	0xffc0, 0x0000, 0xece1, 0xa600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0x000f, 0x8f8e, 0x0000, 0x068f, 0x8f8f,
	0x001f, 0x9f00, 0x0000, 0x001f, 0x9f9f,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0010, 0x0019, 0x9999,
	0x001f, 0x9f00, 0x0010, 0x001f, 0x9f9f,
	0x000f, 0x8f78, 0x70d3, 0xc38f, 0x8f8f,
	0x0001, 0x8184, 0x8934, 0x2441, 0x8181,
	0x0001, 0x8104, 0x8210, 0x2401, 0x8181,
	0x0000, 0x007c, 0x7213, 0xe39f, 0xc1ff,
	0x0000, 0x0084, 0x1a14, 0x20df, 0xc07f,
	0x0000, 0x008c, 0x8934, 0x645f, 0xc007,
	0x0000, 0x0076, 0x70d3, 0xb39f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00fd, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f3, 0x8000,
	0x0000, 0x000f, 0x0e1a, 0x78f3, 0x8000,
	0x0000, 0x0010, 0x9126, 0x84f3, 0x8000,
	0x0000, 0x0000, 0x9042, 0x04f3, 0x8000,
	0x0000, 0x000f, 0x8e42, 0x7ce3, 0x8000,
	0x0000, 0x0010, 0x8342, 0x84e3, 0x8000,
	0x0000, 0x0011, 0x9126, 0x8ce3, 0x8000,
	0x1083, 0x4284, 0x1a14, 0x20d0, 0xa106,
	0x1191, 0x268c, 0x8934, 0x6449, 0xa322,
	0x0ece, 0x1a76, 0x70d3, 0xb386, 0x9d9c,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0x1f1f,
	0x0303, 0x0382, 0x0000, 0x030f, 0x8303,
	0x1f1f, 0x1f9e, 0x0000, 0x071f, 0xdf1f,
	0x3f3f, 0x3fbe, 0x0000, 0x073f, 0xff3f,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xfb33,
	0x3333, 0x33b2, 0x0000, 0x2033, 0xff33,
	0x3f3f, 0x3fbe, 0xf0e1, 0xa03f, 0x7f3f,
	0x1f1f, 0x1f9f, 0x0912, 0x601f, 0x1f1f,
	0x0000, 0x0380, 0x0904, 0x2000, 0x0f80,
	0x0000, 0x0380, 0xf8e4, 0x2600, 0x0780,
	0x0000, 0x0001, 0x0834, 0x2600, 0x0000,
	0x0000, 0x0001, 0x1912, 0x6600, 0x0000,
	0xffc0, 0x0000, 0xece1, 0xa600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0xffc0, 0x0000, 0x0000, 0x0600, 0x0000,
	0x000f, 0x8f8e, 0x0000, 0x068f, 0x8f8f,
	0x001f, 0x9f00, 0x0000, 0x001f, 0x9f9f,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0000, 0x0019, 0x9999,
	0x0019, 0x9900, 0x0010, 0x0019, 0x9999,
	0x001f, 0x9f00, 0x0010, 0x001f, 0x9f9f,
	0x000f, 0x8f78, 0x70d3, 0xc38f, 0x8f8f,
	0x0001, 0x8184, 0x8934, 0x2441, 0x8181,
	0x0001, 0x8104, 0x8210, 0x2401, 0x8181,
	0x0000, 0x007c, 0x7213, 0xe39f, 0xc1ff,
	0x0000, 0x0084, 0x1a14, 0x20df, 0xc07f,
	0x0000, 0x008c, 0x8934, 0x645f, 0xc007,
	0x0000, 0x0076, 0x70d3, 0xb39f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001f, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x001d, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00fd, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0000, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f9, 0xc000,
	0x0000, 0x0000, 0x0002, 0x00f3, 0x8000,
	0x0000, 0x000f, 0x0e1a, 0x78f3, 0x8000,
	0x0000, 0x0010, 0x9126, 0x84f3, 0x8000,
	0x0000, 0x0000, 0x9042, 0x04f3, 0x8000,
	0x0000, 0x000f, 0x8e42, 0x7ce3, 0x8000,
	0x0000, 0x0010, 0x8342, 0x84e3, 0x8000,
	0x0000, 0x0011, 0x9126, 0x8ce3, 0x8000
};

static TEDINFO TEDINFO_01 = { TEXT_08, TEXT_11, TEXT_12, 3, 6, 2, 0x1180, 0, 0, 5, 5 };

static AUSERBLK230 A_USERBLK01 = { A_3Dbutton, 0xa02191f8L, Auo_string, NULL, NULL, NULL };
static AUSERBLK230 A_USERBLK02 = { A_3Dbutton, 0x29c10178L, Auo_string, TEXT_01, NULL, NULL };
static AUSERBLK230 A_USERBLK03 = { A_3Dbutton, 0x29e201f8L, Auo_string, NULL, NULL, NULL };
static AUSERBLK230 A_USERBLK04 = { A_3Dbutton, 0x29c10178L, Auo_string, TEXT_04, NULL, NULL };
static AUSERBLK230 A_USERBLK05 = { A_3Dbutton, 0xa10211a1L, Auo_string, NULL, NULL, NULL };

static AUSERBLK230 A_FTEXT01 = { A_ftext, 0x00118000L, Auo_ftext, TEXT_05, NULL, NULL };

static AUSERBLK230 A_PICTURE01 = { A_picture, 0L, Auo_picture, DATAS_01, NULL, NULL };

static int16 ICN_MSK[] = {
	0xffff, 0xffff, 0xfffc, 0xffff, 0xffff, 0xfffe, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff, 0xffff,
	0xffff, 0xffff, 0xffff, 0xffff, 0x7fff, 0xffff, 0xffff, 0x3fff,
	0xffff, 0xffff
};

static int16 ICN_DATA[] = {
	0xffff, 0xffff, 0xfffc, 0x8000, 0x0000, 0x0006, 0xbfff, 0xffff,
	0xfff7, 0xbfff, 0xffff, 0xfff7, 0xb000, 0x0000, 0x0017, 0xb000,
	0x0000, 0x0317, 0xb000, 0x001e, 0x3dd7, 0xb1ff, 0xff21, 0x0017,
	0xb100, 0x0121, 0x0017, 0xb100, 0x0121, 0x0017, 0xb103, 0x8121,
	0x0017, 0xb103, 0x811e, 0x0017, 0xb103, 0x8100, 0x4017, 0xb173,
	0x9d00, 0x5017, 0xb173, 0x9d00, 0x5017, 0xb173, 0x9d0f, 0xff97,
	0xb17f, 0xfd3f, 0xffd7, 0xb100, 0x011f, 0xff97, 0xb1ff, 0xff00,
	0x0017, 0xb000, 0x0000, 0x0017, 0xb007, 0x007e, 0x0017, 0xb3fc,
	0x2401, 0xf817, 0xb000, 0x4200, 0x0417, 0xb000, 0x8100, 0x0017,
	0xb000, 0x0000, 0x0017, 0xbfff, 0xffff, 0xfff7, 0x8000, 0x0000,
	0x0007, 0xffff, 0xffff, 0xffff, 0x7fff, 0xffff, 0xffff, 0x3fff,
	0xffff, 0xffff
};

static CICONBLK ICON = { { ICN_MSK, ICN_DATA, TEXT_06, 0x1000, 0, 0, 12, 0, 48, 30, 0, 32, 72, 8 }, NULL };


static struct {
	OBJECT root;
	OBJECT user1;
	OBJECT user2;
	AOBJECT _a_user1;
	OBJECT user3;
	AOBJECT _a_user3;
	OBJECT xlabel;
	OBJECT x;
	OBJECT wlabel;
	OBJECT w;
	OBJECT ylabel;
	OBJECT y;
	OBJECT hlabel;
	OBJECT h;
} dim_work = {
	{ -1,  1,  1, 0x0019, 0x0000, 0x0000, C_UNION(0x00ff1141L), 0x0000, 0x0000, 0x0018, 0x0007 },
	{  0,  2, 13, 0x0018, 0x0040, 0x0510, C_UNION(&A_USERBLK03), 0x0000, 0x0000, 0x0018, 0x0007 },
	{  4, -1, -1, 0x0018, 0x4007, 0x0010, C_UNION(&A_USERBLK02), 0x0001, 0x0004, 0x000a, 0x0002 },
	{ NULL, NULL, 0x8000, 0x8818, NULL, NULL, 0, 0 },
	{  6, -1, -1, 0x0018, 0x4005, 0x0010, C_UNION(&A_USERBLK04), 0x000d, 0x0004, 0x000a, 0x0002 },
	{ NULL, NULL, 0x8000, 0x881e, NULL, NULL, 0, 0 },
	{  7, -1, -1, 0x001c, 0x0040, 0x0000, C_UNION(&TEXT_03), 0x0003, 0x0001, 0x0002, 0x0001 },
	{  8, -1, -1, 0x001e, 0x0008, 0x0000, C_UNION(&TEDINFO_01), 0x0005, 0x0001, 0x0004, 0x0001 },
	{  9, -1, -1, 0x001c, 0x0040, 0x0000, C_UNION(&TEXT_07), 0x0003, 0x0002, 0x0002, 0x0001 },
	{ 10, -1, -1, 0x001e, 0x0008, 0x0000, C_UNION(&TEDINFO_01), 0x0005, 0x0002, 0x0004, 0x0001 },
	{ 11, -1, -1, 0x001c, 0x0040, 0x0000, C_UNION(&TEXT_09), 0x000e, 0x0001, 0x0002, 0x0001 },
	{ 12, -1, -1, 0x001e, 0x0008, 0x0000, C_UNION(&TEDINFO_01), 0x0010, 0x0001, 0x0004, 0x0001 },
	{ 13, -1, -1, 0x001c, 0x0040, 0x0000, C_UNION(&TEXT_10), 0x000e, 0x0002, 0x0002, 0x0001 },
	{  1, -1, -1, 0x001e, 0x0028, 0x0000, C_UNION(&TEDINFO_01), 0x0010, 0x0002, 0x0004, 0x0001 }
};

#define DIM_OK 2
#define DIM_X  7
#define DIM_W  9
#define DIM_Y 11
#define DIM_H 13

static struct {
	OBJECT root;
	OBJECT user3;
	OBJECT user;
	OBJECT box;
	OBJECT info;
} info_work = {
	{ -1,  1,  1, 0x0019, 0x0000, 0x0000, C_UNION(0x00ff1141L), 0x0000, 0x0000, 0x001a, 0x0006 },
	{  0,  2,  2, 0x0018, 0x0040, 0x0510, C_UNION(&A_USERBLK03), 0x0000, 0x0000, 0x001a, 0x0006 },
	{  1,  3,  3, 0x0018, 0x0040, 0x0010, C_UNION(&A_USERBLK01), 0x0002, 0x0001, 0x0016, 0x0004 },
	{  2,  4,  4, 0x0014, 0x0040, 0x0000, C_UNION(0x00001101L), 0x0000, 0x0000, 0x0016, 0x0004 },
	{  3, -1, -1, 0x0018, 0x0060, 0x0000, C_UNION(&A_FTEXT01), 0x0001, 0x0000, 0x0014, 0x0004 }
};

static struct {
	OBJECT root;
	AOBJECT _a_root;
	OBJECT user5;
	AOBJECT _a_user5;
} cfg_work = {
	{ -1,  2,  2, 0x0018, 0x0040, 0x0000, C_UNION(&A_PICTURE01), 0x0000, 0x0000, 0x001e, 0x000c },
	{ pic_click, NULL, 0x8000, 0x0000, NULL, NULL, 5, 0 },
	{  0, -1, -1, 0x0018, 0x0040, 0x0010, C_UNION(&A_USERBLK05), 0x0000, 0x0000, 0x000a, 0x0003 },
	{ pic_click2, NULL, 0x8020, 0x0000, NULL, NULL, 3, AT_MFDB }
};

#define VIEW_SEL 2

static Awindow23x main_win = {
	NULL,
	main_service,
	main_create,
	main_open,
	Awi_init,
	NULL,
	NULL,
	0, 0,
	-1,
	0x0fff,
	{ 0, 0, 160, 50 },
	{ 0, 0, 0, 0 },
	{ 0, 0, 0, 0 },
	{ -1, -1, -1, -1 },
	0, 0,
	0xf0f0,
	TEXT_02,
	TEXT_02,
	10000,
	AW_ICON,
	0,
	-1,
	&ICON,
	NULL,
	Awi_keys,
	Awi_obchange,
	Awi_redraw,
	Awi_topped,
	Awi_closed,
	Awi_fulled,
	Awi_arrowed,
	Awi_hslid,
	Awi_vslid,
	Awi_sized,
	Awi_moved,
};

static Awindow23x view_win = {
	NULL,
	view_service,
	view_create,
	Awi_open,
	Awi_init,
	&cfg_work.root,
	NULL,
	0, 0,
	-1,
	0x4fff,
	{ 0, 0, 60, 20 },
	{ 0, 0, 0, 0 },
	{ 0, 0, 0, 0 },
	{ -1, -1, -1, -1 },
	0, 0,
	0xfefe,
	TEXT_02,
	TEXT_02,
	10000,
	AW_ICON | AW_GHOSTICON,
	0,
	-1,
	&ICON,
	NULL,
	Awi_keys,
	Awi_obchange,
	Awi_redraw,
	Awi_topped,
	Awi_closed,
	Awi_fulled,
	Awi_arrowed,
	Awi_hslid,
	Awi_vslid,
	Awi_sized,
	Awi_moved,
};

static Awindow23x dim_win = {
	NULL,
	Awi_service,
	Awi_selfcreate,
	Awi_open,
	Awi_init,
	&dim_work.root,
	NULL,
	0, 0,
	-1,
	NAME | CLOSER | MOVER,
	{ 0, 0, 120, 50 },
	{ 0, 0, 0, 0 },
	{ 0, 0, 0, 0 },
	{ -1, -1, -1, -1 },
	0, 0,
	0xf8f8,
	TEXT_13,
	TEXT_02,
	10000,
	0,
	0,
	-1,
	NULL,
	NULL,
	Awi_keys,
	Awi_obchange,
	Awi_redraw,
	Awi_topped,
	Awi_closed,
	Awi_fulled,
	Awi_arrowed,
	Awi_hslid,
	Awi_vslid,
	Awi_sized,
	Awi_moved,
};

static Awindow23x info_win = {
	NULL,
	Awi_service,
	Awi_selfcreate,
	Awi_open,
	Awi_init,
	&info_work.root,
	NULL,
	0, 0,
	-1,
	NAME | CLOSER | MOVER,
	{ 0, 0, 120, 50 },
	{ 0, 0, 0, 0 },
	{ 0, 0, 0, 0 },
	{ -1, -1, -1, -1 },
	0, 0,
	0xf8f8,
	TEXT_14,
	TEXT_02,
	10000,
	0,
	0,
	-1,
	NULL,
	NULL,
	Awi_keys,
	Awi_obchange,
	Awi_redraw,
	Awi_topped,
	Awi_closed,
	Awi_fulled,
	Awi_arrowed,
	Awi_hslid,
	Awi_vslid,
	Awi_sized,
	Awi_moved,
};

static long num_windows = 0;
static char last_path[128];

#define MOUSE_THIN_CROSS   5
 
/******************************************************************************/
/* -------------------------------------------------------------------------- */
/******************************************************************************/

int16 ACSinit(void)
{
	main_win.create(NULL);
	return OK;
}

/* -------------------------------------------------------------------------- */

static void pic_click2(void)
{
	AOBJECT *aobj;
	MFDB *pic;
	OBJECT *obj;
	int16 pxy[8];
	int16 w;
	int16 h;
	MFDB *bp;
	MFDB *bp2;
	
	if (ACSblk->ev_mmokstate & K_SHIFT)
	{
		pic_click();
	} else
	{
		pic = ACSblk->ev_window->user;
		obj = &ACSblk->ev_object[ACSblk->ev_obnr];
		aobj = (AOBJECT *)obj + 1;
		w = ((obj->ob_width + 15) & -16) - 1;
		h = obj->ob_height - 1;
		pxy[0] = obj->ob_x;
		pxy[1] = obj->ob_y;
		pxy[2] = obj->ob_x + w;
		pxy[3] = obj->ob_y + h;
		pxy[4] = pxy[5] = 0;
		pxy[6] = w;
		pxy[7] = h;
		if ((bp = Abp_create(obj->ob_width, obj->ob_height)) != NULL)
		{
			if ((bp2 = Abp_create(obj->ob_width, obj->ob_height)) != NULL)
			{
				vro_cpyfm(ACSblk->vdi_handle, S_ONLY, pxy, pic, bp);
				vr_trnfm(ACSblk->vdi_handle, bp, bp2);
				aobj->userp1 = bp2;
				Adr_add(ACSblk->ev_window, ACSblk->ev_obnr);
				Adr_drag(ACSblk->ev_mmox, ACSblk->ev_mmoy);
				Adr_del(ACSblk->ev_window, ACSblk->ev_obnr);
				Abp_delete(bp2);
			}
			Abp_delete(bp);
		}
	}
}

/* -------------------------------------------------------------------------- */

static void pic_click(void)
{
	Awindow *self = ACSblk->ev_window;
	OBJECT *obj = &self->work[VIEW_SEL];
	Awindow *win;
	int16 x;
	int16 y;
	int16 w;
	int16 h;
	char buf[80];
	
	Amo_new(&ACSblk->description->mouse[MOUSE_THIN_CROSS]);
	if (ACSblk->ev_object[ACSblk->ev_obnr].ob_state & AOS_DCLICK)
	{
		if ((win = dim_win.create(&dim_win)) == NULL)
			return;
#ifdef __GNUC__
		x = obj->ob_x;
		y = obj->ob_y;
		w = obj->ob_width;
		h = obj->ob_height;
#endif
		sprintf(win->work[DIM_X].ob_spec.tedinfo->te_ptext, "%3d", obj->ob_x);
		sprintf(win->work[DIM_Y].ob_spec.tedinfo->te_ptext, "%3d", obj->ob_y);
		sprintf(win->work[DIM_W].ob_spec.tedinfo->te_ptext, "%3d", obj->ob_width);
		sprintf(win->work[DIM_H].ob_spec.tedinfo->te_ptext, "%3d", obj->ob_height);
		if (Awi_dialog(win) == DIM_OK)
		{
#ifndef __PUREC__
			int val;
			sscanf(win->work[DIM_X].ob_spec.tedinfo->te_ptext, "%d", &val);
			x = val;
			sscanf(win->work[DIM_Y].ob_spec.tedinfo->te_ptext, "%d", &val);
			y = val;
			sscanf(win->work[DIM_W].ob_spec.tedinfo->te_ptext, "%d", &val);
			w = val;
			sscanf(win->work[DIM_H].ob_spec.tedinfo->te_ptext, "%d", &val);
			h = val;
#else
			sscanf(win->work[DIM_X].ob_spec.tedinfo->te_ptext, "%d", &x);
			sscanf(win->work[DIM_Y].ob_spec.tedinfo->te_ptext, "%d", &y);
			sscanf(win->work[DIM_W].ob_spec.tedinfo->te_ptext, "%d", &w);
			sscanf(win->work[DIM_H].ob_spec.tedinfo->te_ptext, "%d", &h);
#endif
		}
		Awi_delete(win);
	} else
	{
		x = ACSblk->ev_mmox;
		y = ACSblk->ev_mmoy;
		graf_rubberbox(x, y, -4000, -4000, &w, &h);
		x -= self->wi_work.x + ACSblk->ev_object->ob_x;
		y -= self->wi_work.y + ACSblk->ev_object->ob_y;
	}
	if (w < 0)
	{
		x += w;
		w = -w;
	}
	if (h < 0)
	{
		y += h;
		h = -h;
	}
	if (x < 0)
	{
		w += x;
		x = 0;
	}
	if (y < 0)
	{
		h += y;
		y = 0;
	}
	if ((x + w) > ACSblk->ev_object->ob_width)
		w = ACSblk->ev_object->ob_width - x;
	if ((y + h) > ACSblk->ev_object->ob_height)
		h = ACSblk->ev_object->ob_height - y;
	obj->ob_x = x;
	obj->ob_y = y;
	obj->ob_width = w;
	obj->ob_height = h;
	sprintf(buf, " (%d,%d) + (%d, %d)", x, y, w, h);
	Ast_delete(self->info);
	self->info = Ast_create(buf);
	if (self->wi_id > 0)
#ifdef __GNUC__
		wind_set_str(self->wi_id, WF_INFO, self->info);
#else
		wind_set(self->wi_id, WF_INFO, self->info, 0, 0);
#endif
	self->obchange(self, ROOT, -1);
}

/* -------------------------------------------------------------------------- */

static Awindow *main_create(void *para)
{
	Awindow *self;
	long fd;
	
	UNUSED(para);
	self = Awi_create((Awindow *)&main_win);
	if (self == NULL)
		return NULL;
	fd = Fopen(Af_cfgfile("IMGVIEW"), FO_READ);
	if (fd > 0)
	{
		Fread((int)fd, sizeof(last_path), last_path);
		Fclose((int)fd);
	}
	return self;
}

/* -------------------------------------------------------------------------- */

static int16 main_open(Awindow *self)
{
	char *filename;
	
	UNUSED(self);
	filename = Af_select(TEXT_15, last_path, "IMG");
	if (filename != NULL)
		view_win.create(filename);
	return FAIL;
}

/* -------------------------------------------------------------------------- */

static boolean main_service(Awindow *self, int16 task, void *in_out)
{
	long fd;
	Awindow *win;
	
	UNUSED(in_out);
	switch (task)
	{
	case AS_TERM:
		if (ACSblk->appexit || num_windows == 0)
		{
			fd = Fcreate(Af_cfgfile("IMGVIEW"), FA_HIDDEN);
			if (fd > 0)
			{
				Fwrite((int)fd, sizeof(last_path), last_path);
				Fclose((int)fd);
			}
			Awi_delete(self);
#ifdef __ACS_MODULE__
			ACSmoduleterm();
#endif
		}
		break;
	
	case AS_INFO:
		win = info_win.create(&info_win);
		if (win != NULL)
		{
			Awi_dialog(win);
			Awi_delete(win);
		}
		break;
	
	default:
		return FALSE;
	}
	return TRUE;
}

/* -------------------------------------------------------------------------- */

static Awindow *view_create(void *para)
{
	Awiob wiob;
	MFDB *bp = NULL;
	Awindow *self;
	long fd;
	long size;
	void *buf;
	char *basename;
	char name[120];
	char info[40];
	OBJECT *obj;
	
	if ((fd = Fopen(para, FO_READ)) < 0)
		return NULL;
	size = Fseek(0L, (int)fd, SEEK_END);
	Fseek(0L, (int)fd, SEEK_SET);
	buf = Ax_malloc(size);
	if (buf == NULL)
	{
		Fclose((int) fd);
		return NULL;
	}
	if (Fread((int)fd, size, buf) != size)
	{
		Ax_ifree(buf);
		Fclose((int) fd);
		return NULL;
	}
	Fclose((int) fd);
	if (Abp_img2mfdb(buf, &bp, TRUE) != OK)
	{
		Ax_ifree(buf);
		return NULL;
	}
	Ax_free(buf);
	
	basename = strrchr(para, '\\');
	if (basename != NULL)
		basename++;
	else
		basename = para;
	view_win.iconblk->monoblk.ib_ptext = basename;
	strcat(strcat(strcpy(name, " "), para), " ");
	view_win.name = name;
	sprintf(info, " (0,0) + (%d,%d)", bp->fd_w, bp->fd_h);
	view_win.info = info;
	self = Awi_create((Awindow *)&view_win);
	if (self == NULL)
	{
		Abp_delete(bp);
		return NULL;
	}
	self->user = bp;
	self->work[ROOT].ob_width = self->work[VIEW_SEL].ob_width = bp->fd_w;
	self->work[ROOT].ob_height = self->work[VIEW_SEL].ob_height = bp->fd_h;
	wiob.window = self;
	obj = &self->work[ROOT];
	wiob.entry = obj;
	wiob.obnr = ROOT;
	Auo_picture(obj, AUO_SELF, &wiob);
	Auo_picture(obj, AUO_PICMFDB, bp);
	
	self->open(self);
	num_windows += 1;
	
	return self;
}

/* -------------------------------------------------------------------------- */

static boolean view_service(Awindow *self, int16 task, void *in_out)
{
	switch (task)
	{
	case AS_TERM:
		Awi_delete(self);
		num_windows -= 1;
		break;
	
	case AS_CHECKDELETE:
		*((boolean *)in_out) = FALSE;
		break;
	
	default:
		return Awi_service(self, task, in_out);
	}
	return TRUE;
}
